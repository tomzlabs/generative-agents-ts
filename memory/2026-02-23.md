# 2026-02-23

- 用户询问 Conway 是否已可交互交付客户使用。
- 已完成必读上下文加载（SOUL/USER/昨日记忆；`MEMORY.md` 不存在）。
- Conway 代码链路检查：
  - 前端 Runtime：`src/core/conway/runtime.ts`
  - 地图高级面板交互：`src/components/Map/VillageMap.tsx`
  - 服务端代理：`api/conway/[...path].ts`
- 验证结果：
  - `npm run build` 通过。
  - Playwright 整页验证可打开 `/map` 高级面板并看到 `Conway Runtime` 控制区。
  - 在当前本地 `vite dev` 环境点击 `Create Sandbox` 返回 `Conway API error: 404 Not Found`，说明未连通可用 Conway 后端代理。
- 结论：前端交互入口已完成，但“客户可用”仍依赖服务端 Conway 代理与环境变量配置生效。
- 线上复验（用户提供 URL：`https://generative-agents-ts.vercel.app/`）：
  - 可进入地图并展开高级面板，但 DOM 中不存在 `.village-conway-card`，页面文本不含 `Conway Runtime`。
  - 线上 JS 资源为 `index-Cqgg_uzL.js`，检索不到 `Conway` 相关字符串。
  - `GET /api/conway/sandboxes` 返回 `index.html`（未命中 Conway API）。
  - 结论：当前线上部署不是含 Conway 集成的构建，暂不可用于 Conway 客户交互验收。
- 用户再次部署后复验：
  - 首页资源已更新为 `index-DJWdpYUU.js`，Conway UI 已可见。
  - 但 `POST /api/conway/sandboxes` 仍返回 `405`，页面 `Create Sandbox` 报错一致：`Conway API error: 405`。
  - 结论：前端已到位，但服务端 `/api/conway` 仍未命中/未生效，客户侧 Conway 创建流程仍不可用。
- 修复动作：
  - 更新 `vercel.json` 路由，新增显式 `/api/(.*)` 映射，并将 SPA fallback 限制为非 API 路径：`/((?!api(?:/|$)).*) -> /index.html`。
  - 目标：避免 `POST /api/conway/*` 被回退到静态 `index.html` 导致 `405`。
  - 本地 `npm run build` 验证通过。
